package singleton;

import java.util.HashMap;
import java.util.Map;

import exercice2.etape1.*;

public aspect ASingleton {
	
	private Map<Class<?>, Object> singletons = new HashMap<Class<?>, Object>();
	
	pointcut newClients():
		call(public Clients.new(..));
	
	//pointcut execClients():
		//execution(public Clients.new(..));
	
	Object around(): newClients() {
		
		System.out.println("ASingleton : ex√©cution de new Clients");
		
		Class<?> singletonClass = thisJoinPoint.getSignature().getDeclaringType();
		Object singletonObject = this.singletons.get(singletonClass);
		
		if(singletonObject == null) System.out.println("ASingleton: singleton est nulle");
		
		
		if(singletonObject == null) {
			
			singletonObject = proceed();
			System.out.println("ASingleton: "+singletonObject);
			this.singletons.put(singletonClass, singletonObject);
		}
		
		
		return singletonObject;
		
	}
}
